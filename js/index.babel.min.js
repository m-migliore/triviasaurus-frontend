"use strict";var currentTile=document.getElementById("current-tile"),welcome=document.getElementById("welcome"),loginForm=document.getElementById("login-form"),currentUser=void 0,currentGame=void 0,gameQuestions=[],streak=0,roundCounter=1;function postLogin(){currentTile.innerHTML='\n  <div id="user" class="tile">\n    <img src="img/dino.png" alt="Dino" class="dino animated jello">\n    <h1>Welcome '+currentUser.username+'</h1>\n    <div class="divider"></div>\n    <div class="row">\n      <div class="col">\n        <button type="button" class="btn btn-primary" data-user_id="'+currentUser.id+'" data-action="stats">View Stats</button>\n      </div>\n      <div class="col">\n        <button type="button" class="btn btn-primary" data-action="play">Play Game</button>\n      </div>\n      <div class="col">\n        <button type="button" class="btn btn-primary" data-action="leaderboard">View Leaderboard</button>\n      </div>\n    </div>\n  </div>'}function createUser(n){fetch("http://localhost:3000/api/v1/users",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:n})}).then(function(n){return n.json()}).then(function(n){currentUser=n,postLogin()})}function viewStats(n){fetch("http://localhost:3000/api/v1/users/"+n+"/stats").then(function(n){return n.json()}).then(function(n){var t=n.categoryStats,e=Object.keys(t).map(function(n){return renderCategoryStats(n,t)}).join("");currentTile.innerHTML='\n      <div id="user" class="tile">\n        <img src="img/dino.png" alt="Dino" class="dino animated jello">\n        <h1>'+n.username+'\'s Stats</h1>\n        <div class="divider"></div>\n        <div class="row">\n          <div class="col">\n            <button type="button" class="btn btn-primary" data-action="play">Play Game</button>\n          </div>\n          <div class="col">\n            <button type="button" class="btn btn-primary" data-action="leaderboard">View Leaderboard</button>\n          </div>\n        </div>\n        <div class="row">\n          <div class="col">\n            <div class="stat-box main-total">\n              <h2>Total Stats</h2>\n              <div class="divider"></div>\n              <ul>\n                <li><span>Wins:</span> '+n.totalStats.wins+"</li>\n                <li><span>Total:</span> "+n.totalStats.total+"</li>\n                <li><span>Percentage:</span> "+n.totalStats.winPercentage+"%</li>\n                <li><span>ELO:</span> "+n.totalStats.elo+'</li>\n              </ul>\n            </div>\n\n            <div class="stat-box">\n              <h4>Easy Breakdown</h4>\n              <ul>\n                <li><span>Wins:</span> '+n.totalStats.easyWins+"</li>\n                <li><span>Total:</span> "+n.totalStats.easyTotal+"</li>\n                <li><span>Percentage:</span> "+n.totalStats.easyPercentage+'%</li>\n              </ul>\n            </div>\n\n            <div class="stat-box">\n              <h4>Medium Breakdown</h4>\n              <ul>\n                <li><span>Wins:</span> '+n.totalStats.mediumWins+"</li>\n                <li><span>Total:</span> "+n.totalStats.mediumTotal+"</li>\n                <li><span>Percentage:</span> "+n.totalStats.mediumPercentage+'%</li>\n              </ul>\n            </div>\n\n            <div class="stat-box">\n              <h4>Hard Breakdown</h4>\n              <ul>\n                <li><span>Wins:</span> '+n.totalStats.hardWins+"</li>\n                <li><span>Total:</span> "+n.totalStats.hardTotal+"</li>\n                <li><span>Percentage:</span> "+n.totalStats.hardPercentage+'%</li>\n              </ul>\n            </div>\n\n            <div>\n              <h2>Category Stats</h2>\n              <div class="divider"></div>\n              <table class="table table-striped">\n                <thead>\n                  <tr>\n                    <th scope="col">Category</th>\n                    <th scope="col">Wins</th>\n                    <th scope="col">Total</th>\n                    <th scope="col">Percentage</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  '+e+"\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n      </div>"})}function renderCategoryStats(n,t){return"\n    <tr>\n      <td>"+n+"</td>\n      <td>"+t[n].wins+"</td>\n      <td>"+t[n].total+"</td>\n      <td>"+t[n].winPercentage+"%</td>\n    </tr>"}function newGame(){roundCounter=1,streak=0,currentTile.innerHTML='\n  <div id="new-game" class="tile">\n    <img src="img/dino.png" alt="Dino" class="dino animated jello">\n    <h1>New Game</h1>\n    <div class="divider"></div>\n    <form id="new-game-form" data-action="new_game" data-id="'+currentUser.id+'">\n      <div class="form-group">\n        <label for="question-amount">Question Amount</label>\n        <select class="form-control" id="question-amount">\n          <option>1</option>\n          <option>3</option>\n          <option>5</option>\n          <option>10</option>\n          <option>15</option>\n        </select>\n      </div>\n      <div class="form-group">\n        <label for="game-difficulty">Difficulty</label>\n        <select class="form-control" id="game-difficulty">\n          <option value="any">Any Difficulty</option>\n          <option value="easy">Easy</option>\n          <option value="medium">Medium</option>\n          <option value="hard">Hard</option>\n        </select>\n      </div>\n      <div class="form-group">\n        <label for="game-category">Category</label>\n        <select class="form-control" id="game-category">\n          <option value="any">Any Category</option>\n          <option value="9">General Knowledge</option>\n          <option value="10">Entertainment: Books</option>\n          <option value="11">Entertainment: Film</option>\n          <option value="12">Entertainment: Music</option>\n          <option value="13">Entertainment: Musicals &amp; Theatres</option>\n          <option value="14">Entertainment: Television</option>\n          <option value="15">Entertainment: Video Games</option>\n          <option value="16">Entertainment: Board Games</option>\n          <option value="17">Science &amp; Nature</option>\n          <option value="18">Science: Computers</option>\n          <option value="19">Science: Mathematics</option>\n          <option value="20">Mythology</option>\n          <option value="21">Sports</option>\n          <option value="22">Geography</option>\n          <option value="23">History</option>\n          <option value="24">Politics</option>\n          <option value="25">Art</option>\n          <option value="26">Celebrities</option>\n          <option value="27">Animals</option>\n          <option value="28">Vehicles</option>\n          <option value="29">Entertainment: Comics</option>\n          <option value="30">Science: Gadgets</option>\n          <option value="31">Entertainment: Japanese Anime &amp; Manga</option>\n          <option value="32">Entertainment: Cartoon &amp; Animations</option>\n        </select>\n      </div>\n      <button type="button" data-action="start_game" class="btn btn-primary">Start Game</button>\n    </form>\n  </div>'}function loadGame(){createGame(),addRounds()}function createGame(){fetch("http://localhost:3000/api/v1/games",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({user_id:currentUser.id})}).then(function(n){return n.json()}).then(function(n){currentGame=n})}function addRounds(){var n=currentTile.querySelector("#question-amount").value,t=currentTile.querySelector("#game-difficulty").value,e=void 0,a=currentTile.querySelector("#game-category").value,i=void 0;e="any"===t?"":"&difficulty="+t,i="any"===a?"":"&category="+a,fetch("https://opentdb.com/api.php?amount="+n+"&type=multiple"+e+i).then(function(n){return n.json()}).then(function(n){var t=n.results;return currentTile.innerHTML="",t.forEach(function(n){gameQuestions.push(n)}),gameQuestions}).then(function(n){n.length>0?loadRound():noQuestions()})}function createRound(n){currentTile.innerHTML="",fetch("http://localhost:3000/api/v1/rounds",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({game_id:currentGame.id,category:n.category,difficulty:n.difficulty,question:n.question,correct_answer:n.correct_answer,incorrect_answer_1:n.incorrect_answers[0],incorrect_answer_2:n.incorrect_answers[1],incorrect_answer_3:n.incorrect_answers[2],correct:!1})}).then(function(n){return n.json()}).then(function(n){currentTile.innerHTML+=renderQuestion(n,roundCounter),roundCounter++})}function loadRound(){currentTile.innerHTML="",gameQuestions.length>0?createRound(gameQuestions.pop()):gameResults()}function checkAnswer(n,t){currentTile.querySelector('.question[data-id="'+n+'"]');fetch("http://localhost:3000/api/v1/rounds/"+n).then(function(n){return n.json()}).then(function(e){e.correct_answer.replace(/ /g,"")===t.replace(/ /g,"")?(answerQuestion(n,t,!0),streak++,console.log(streak)):answerQuestion(n,t)})}function gameResults(){fetch("http://localhost:3000/api/v1/games/"+currentGame.id).then(function(n){return n.json()}).then(function(n){var t=n.rounds.filter(function(n){return n.correct}),e=n.rounds.map(function(n){return renderAnsweredQuestion(n)}).join("");currentTile.innerHTML='\n    <div id="results" class="tile">\n      <img src="img/dino.png" alt="Dino" class="dino animated jello">\n      <h1>Game Results</h1>\n      <div class="divider"></div>\n      <h2 class="score animated jackInTheBox">Your Score: '+Math.round(t.length/n.rounds.length*100)+'<span>%</span></h2>\n      <div class="row">\n        <div class="col">\n          <button type="button" class="btn btn-primary" data-user_id="'+currentUser.id+'" data-action="stats">View Stats</button>\n        </div>\n        <div class="col">\n          <button type="button" class="btn btn-primary" data-action="play">Play Game</button>\n        </div>\n        <div class="col">\n          <button type="button" class="btn btn-primary" data-action="leaderboard">View Leaderboard</button>\n        </div>\n      </div>\n      '+e+"\n    </div>"})}function answerQuestion(n,t){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];fetch("http://localhost:3000/api/v1/rounds/"+n,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({answer:t,correct:e})}).then(function(n){return n.json()}).then(function(n){currentTile.querySelector('.question[data-id="'+n.id+'"]');loadRound()})}function renderQuestion(n,t){var e=[];return e.push(n.correct_answer),e.push(n.incorrect_answer_1),e.push(n.incorrect_answer_2),e.push(n.incorrect_answer_3),shuffle(e),'\n    <div class="question" data-id="'+n.id+'">\n      <img src="img/dino.png" alt="Dino" class="dino animated jello">\n      <h1>Question '+t+'</h1>\n      <div class="divider"></div>\n      <h3>'+n.question+'</h3>\n      <ul>\n        <li data-game_id="'+n.game_id+'" data-id="'+n.id+'" data-action="answer">'+e[0]+'</li>\n        <li data-game_id="'+n.game_id+'" data-id="'+n.id+'" data-action="answer">'+e[1]+'</li>\n        <li data-game_id="'+n.game_id+'" data-id="'+n.id+'" data-action="answer">'+e[2]+'</li>\n        <li data-game_id="'+n.game_id+'" data-id="'+n.id+'" data-action="answer">'+e[3]+"</li>\n      </ul>\n    </div>"}function renderAnsweredQuestion(n){return n.correct?'\n      <div class="question correct" data-id="'+n.id+'">\n        <h3>'+n.question+"</h3>\n        <h4>Correct Answer</h4>\n        <p>"+n.correct_answer+"</p>\n        <h4>Difficulty</h4>\n        <p>"+n.difficulty+"</p>\n      </div>":'\n      <div class="question incorrect" data-id="'+n.id+'">\n        <h3>'+n.question+"</h3>\n        <h4>Your Answer</h4>\n        <p>"+n.answer+"</p>\n        <h4>Correct Answer</h4>\n        <p>"+n.correct_answer+"</p>\n        <h4>Difficulty</h4>\n        <p>"+n.difficulty+"</p>\n      </div>"}function viewLeaderboard(n){fetch("http://localhost:3000/api/v1/users/leaderboard/"+n).then(function(n){return n.json()}).then(function(n){var t=n.map(function(n){return renderLeaderboardRow(n)}).join("");currentTile.innerHTML='\n      <div id="leaderboard" class="tile">\n        <img src="img/dino.png" alt="Dino" class="dino animated jello">\n        <h1>Leaderboard</h1>\n        <div class="divider"></div>\n\n        <div class="row">\n          <div class="col">\n            <button type="button" class="btn btn-primary" data-user_id="'+currentUser.id+'" data-action="stats">View Stats</button>\n          </div>\n          <div class="col">\n            <button type="button" class="btn btn-primary" data-action="play">Play Game</button>\n          </div>\n        </div>\n\n        <table class="table table-striped">\n          <thead>\n            <tr>\n              <th scope="col">Username</th>\n              <th scope="col" data-action="switch" data-leaderboard="wins">Wins</th>\n              <th scope="col" data-action="switch" data-leaderboard="total">Total</th>\n              <th scope="col" data-action="switch" data-leaderboard="percentage">Percentage</th>\n              <th scope="col" data-action="switch" data-leaderboard="elo">ELO</th>\n            </tr>\n          </thead>\n          <tbody>\n            '+t+"\n          </tbody>\n        </table>\n      </div>"})}function renderLeaderboardRow(n){return'\n    <tr>\n      <td><span class="user-link" data-action="stats" data-user_id="'+n.id+'">'+n.username+"</span></td>\n      <td>"+n.wins+"</td>\n      <td>"+n.total+"</td>\n      <td>"+n.winPercentage+"%</td>\n      <td>"+n.elo+"</td>\n    </tr>"}function noQuestions(){currentTile.innerHTML='\n  <div id="extinct" class="tile">\n    <img src="img/dino.png" alt="Dino" class="dino animated jello">\n    <h1>Uh Oh</h1>\n    <div class="divider"></div>\n    <p>The questions for this game are extinct please try again.</p>\n    <div class="row">\n      <div class="col">\n        <button type="button" class="btn btn-primary" data-user_id="'+currentUser.id+'" data-action="stats">View Stats</button>\n      </div>\n      <div class="col">\n        <button type="button" class="btn btn-primary" data-action="play">Play Game</button>\n      </div>\n      <div class="col">\n        <button type="button" class="btn btn-primary" data-action="leaderboard">View Leaderboard</button>\n      </div>\n    </div>\n  </div>'}function shuffle(n){for(var t,e,a=n.length;0!==a;)e=Math.floor(Math.random()*a),t=n[a-=1],n[a]=n[e],n[e]=t;return n}currentTile.addEventListener("click",function(n){"play"===n.target.dataset.action?newGame():"stats"===n.target.dataset.action?viewStats(n.target.dataset.user_id):"start_game"===n.target.dataset.action?(n.target.setAttribute("disabled",!0),loadGame()):"answer"===n.target.dataset.action?checkAnswer(n.target.dataset.id,n.target.innerText):"leaderboard"===n.target.dataset.action?viewLeaderboard("elo"):"switch"===n.target.dataset.action&&viewLeaderboard(n.target.dataset.leaderboard)}),loginForm.addEventListener("submit",function(n){n.preventDefault();var t=loginForm.querySelector("#username").value,e=loginForm.querySelector("#error");""===t?e.innerText="Please enter a username":fetch("http://localhost:3000/api/v1/users").then(function(n){return n.json()}).then(function(n){void 0===(currentUser=n.find(function(n){return n.username===t}))?createUser(t):postLogin()})});
